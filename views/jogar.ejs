<!DOCTYPE html>
<html dir="ltr" lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0" name="viewport"/>
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
    <link href="/images/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
    <link href="/images/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
    <link color="#5bbad5" href="/images/safari-pinned-tab.svg" rel="mask-icon">
    <meta content="#da532c" name="msapplication-TileColor">
    <meta content="#ffffff" name="theme-color">
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <script src="/scripts/fases.js"></script>
    <link href="/styles/reset.css" rel="stylesheet">
    <link href="/styles/fases.css" rel="stylesheet">
    <link href="/styles/custom.css" rel="stylesheet">
    <title>RiddleZinho - Jogar</title>
    <style>
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .welcome {
            color: #333;
        }
        .score-badge {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        .btn-logout {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .game-links {
            display: flex;
            gap: 10px;
        }
        .leaderboard-link, .login-link {
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .leaderboard-link {
            background: #007bff;
            color: white;
        }
        .leaderboard-link:hover {
            background: #0056b3;
        }
        .login-link {
            background: #6c757d;
            color: white;
        }
        .login-link:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="game-header">
        <div class="user-info" id="user-info" style="display: none;">
            <span class="welcome">Ol치, <strong id="username">-</strong></span>
            <span class="score-badge">Score: <strong id="user-score">0</strong></span>
            <button onclick="logout()" class="btn-logout">Sair</button>
        </div>
        <div class="game-links">
            <a href="/leaderboard" class="leaderboard-link">游끥 Leaderboard</a>
            <a href="/login" class="login-link" id="login-link">Login / Registro</a>
        </div>
    </div>

    <div class="center">
        <a aria-label="Voltar a p치gina inicial" href="/" title="Voltar a p치gina inicial">
            <img alt="RiddleZinho - um pequeno jogo tipo riddle" src="/images/logonova2.jpg">
        </a>
    </div>

    <hr/>

    <ul class="center nav flex-column menu-secundario">
        <li class="nav-item">
            <a class="nav-link" href="/fase/fasezero">N칤vel 1</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/fase/nivel2">N칤vel 2</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/fase/nivel3">N칤vel 3</a>
        </li>
    </ul>

    <a aria-label="Voltar a p치gina inicial" class="voltar-link" href="/" title="Voltar a p치gina inicial">voltar a p치gina inicial</a>

    <script>
        function checkAuth() {
            const token = localStorage.getItem('authToken');
            const user = JSON.parse(localStorage.getItem('user') || '{}');

            if (token && user.username) {
                document.getElementById('user-info').style.display = 'flex';
                document.getElementById('username').textContent = user.username;
                document.getElementById('login-link').style.display = 'none';
                loadUserScore();
            }
        }

        async function loadUserScore() {
            const token = localStorage.getItem('authToken');
            if (!token) return;

            try {
                const response = await fetch('/auth/profile', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.user && data.user.stats) {
                        document.getElementById('user-score').textContent = data.user.stats.score || 0;
                    }
                } else {
                    logout();
                }
            } catch (error) {
                console.error('Erro ao carregar score:', error);
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            window.location.reload();
        }

        window.addEventListener('DOMContentLoaded', checkAuth);
    </script>
</body>
</html>
